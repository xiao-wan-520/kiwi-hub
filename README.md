# KiwiHub (奇异果社区) - 项目设计文档

## 1. 项目背景与简介

**KiwiHub** 是一个基于微服务架构构建的**高性能社交内容分享平台**。该项目旨在为用户提供一个轻量、实时、高互动的社区环境。系统摒弃了传统的关系型数据库依赖，全面探索 **NoSQL（MongoDB + Redis）** 在高并发社交场景下的应用，实现了从用户注册、内容发布、多级评论互动到短链接分享的全链路业务。

关于命名：为什么叫 "KiwiHub"？

- **Kiwi (奇异果):** 象征着**新鲜**与**活力**。寓意社区内容的实时性（Freshness）和高营养价值（Quality），给人一种年轻、极客的清爽感。
- **Hub (枢纽):** 代表连接。这里不仅是内容的存储地，更是用户与用户、用户与技术之间连接的中心。



## 2. 技术架构与选型

本项目采用 **Spring Cloud Alibaba** 微服务生态体系，数据存储采用 **“全 NoSQL”** 策略以应对非结构化数据和高读写需求。

| **类别**     | **技术栈**                                | **选型理由**                                                 |
| ------------ | ----------------------------------------- | ------------------------------------------------------------ |
| **核心框架** | Spring Boot 3.4.12 + Spring Cloud Alibaba | 工业界主流微服务解决方案，生态完善。                         |
| **服务治理** | Nacos + Spring Cloud Gateway              | 实现服务注册发现、配置管理及统一网关鉴权。                   |
| **核心存储** | **MongoDB**                               | 利用其 Schema-less 特性存储用户画像及异构的文章/评论数据，支持海量数据水平扩展。 |
| **高速缓存** | **Redis**                                 | 用于短链接映射、点赞计数、热点数据缓存及分布式锁。           |
| **对象存储** | **七牛云 OSS**                            | 图片、文章、视频等静态资源的云端托管。                       |
| **消息队列** | **RabbitMQ**                              | Feed流推送、数据统计（阅读量统计）、系统通知（新粉丝通知）等，实现系统解耦。 |



## 3. 微服务模块拆解与职责

系统被拆分为三个核心业务微服务，通过 RESTful API 进行交互。

### 1. 用户中心服务 (kiwi-user)

**定位：** 基于 MongoDB 的用户身份管家。

- **核心职责：**
  - **身份认证：** 负责用户的注册、登录，使用分布式Session。
  - **画像管理：** 利用 MongoDB 灵活的文档结构，存储用户多变的属性（头像、签名、标签、社交链接），无需频繁变更表结构。
  - **关注体系：** 管理用户之间的关注与粉丝关系（Follow/Fans），支持快速查询“我关注的人”。



###  2. 内容交互服务 (kiwi-content)

**定位：** 流量与数据的核心载体。

- **核心职责：**
  - **文章管理：** 文章的发布、编辑与删除。文章正文存储在 MongoDB，图片/视频上传至七牛云 OSS，数据库仅存 URL。
  - **盖楼评论：** 设计嵌套式（Nested）或树形结构的评论系统，利用 MongoDB 单文档原子性支持高并发下的评论写入。
  - **点赞聚合：** 使用 **Redis Set/HyperLogLog** 实现高性能点赞与去重。通过定时任务或消息队列将点赞数异步同步回 MongoDB，避免高频写库。



###  3. 短链接服务 (kiwi-link)

**定位：** 高并发的基础设施工具。

- **核心职责：**
  - **长短链转换：** 将站内的长文章链接压缩为短链接（如 `kiwi.hub/x7z9A`），便于在第三方平台分享。
  - **算法实现：** 采用 **MurmurHash + Base62** 编码生成短码。
  - **防重与缓存：** 引入 **布隆过滤器 (Bloom Filter)** 快速判断短码是否已存在，防止哈希冲突；利用 Redis 缓存热点映射关系，提升重定向速度。



### 4. 项目亮点

1. **纯 NoSQL 架构实践：** 无论是用户模型还是内容模型，均采用 MongoDB 设计，展示了对文档型数据库建模（Schema Design）的深入理解，区别于传统的 MySQL 架构。
2. **高性能短链系统：** 独立拆分短链接服务，解决了海量短码生成的冲突检测与高并发读取问题，具备工业级的系统设计思维。
3. **读写分离与冷热分离：** 静态资源上云（OSS），热点数据入缓存（Redis），持久化数据落库（Mongo），构建了多级存储体系。

